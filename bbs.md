# BBS（掲示板）機能設計

## 1. 目的・コンセプト
- 1990年代～2000年代初頭の個人ホームページにあった「シンプルな掲示板」を再現
- Cloudflare Workers + Durable Objects を活用し、エッジで動作・一貫性・リアルタイム性を担保
- セキュリティ（XSS/CSRF対策）や最低限のスパム対策も考慮

## 2. 機能要件
- 投稿（名前・本文・任意で削除キー）
- 投稿一覧表示（最新順 or 古い順）
- 投稿数上限（例: 最新100件まで）
- 投稿削除（削除キー or 管理者キー）
- 投稿内容のエスケープ・改行変換
- CSRF対策（X-Requested-Withヘッダ必須）
- スパム・連投対策（簡易的なIP制限や投稿間隔制限も検討）

## 3. API設計
- `GET  /bbs/list`   : 投稿一覧取得（JSON）
- `POST /bbs/post`   : 新規投稿（JSON or form、CSRF対策）
- `POST /bbs/delete` : 投稿削除（削除キー必須、CSRF対策）

## 4. データ構造
- Durable Objectで管理
- 投稿: { id, name, body, date, deleteKey? }
- 投稿は配列で保存、上限超過時は古いものから削除

## 5. フロントエンド
- `public/bbs.html`（またはindex.htmlに組み込み）
- 投稿フォーム（名前・本文・削除キー）
- 投稿一覧表示（HTMLで整形、XSS対策）
- 投稿時はfetchでAPIにPOST、成功時に一覧を再取得

## 6. セキュリティ・運用
- XSS対策（投稿内容のエスケープ）
- CSRF対策（X-Requested-With: XMLHttpRequest）
- 投稿間隔制限やIP制限（必要に応じて）

### スパム対策の具体例
- 投稿間隔制限（クールタイム）：同一IPや同一セッションからの連続投稿を数秒～数十秒に1回までに制限
- 入力値バリデーション：名前・本文の長さ制限、空投稿や極端に長い投稿の拒否
- JavaScript必須：フォーム送信はfetch経由のみ許可
- 必要に応じて簡単な質問やhiddenフィールドの導入
- IPアドレスごとの投稿数制限：一定期間内の投稿数を制限
- 禁止ワードやURLの過剰投稿制限（必要に応じて）

## 7. 拡張性
- スレッド式や返信機能、画像添付なども将来的に拡張可能な設計
- 投稿データのエクスポート・インポートも検討可
